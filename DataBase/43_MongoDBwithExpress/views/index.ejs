<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatApp</title>
    <Link rel="stylesheet" href="style.css"
</head>
<body>
    <h1>Chat me apka swagat hai</h1>
    <form action="/chats/new" method="get"> 
        <button>New Chat</button>
    </form>
    <center><h2>All chats</h2></center>
    <% for (chat of chats){ %>
      <div class="chat">
        <p>
            From:  <i><%= chat.from %>  </i>
        </p>
        <p class="message"> <%= chat.message %></p>
        <p>Received by <i> <%= chat.to %> </p> </i>
        <hr>
        <p> <%= chat.createdAt.toString().split(" ")[4]%></p>
        <!-- <p> <%= chat.createdAt%></p> -->
        <p> <%= chat.createdAt.toString().split(" ").slice(0,4).join(" ") %></p>
        <hr>
        <p> Update time<%= chat.updatedAt.toString().split(" ")[4] %></p>
        <form action="/chats/<%= chat._id %>/edit" method="get">
            <button>Edit</button>
        </form> <BR></BR>
        <form action="/chats/<%= chat._id%>?_method=DELETE" method="post">
            <!-- <button onclick="confirmDelete()" >Delete</button> -->
             <button onclick="deleteChat('64abcd1234...')">Delete</button>

        </form>

      </div>
      <br><br>
      <hr>
      

  <% } %>



<script>
  function deleteChat(chatId) {
    if (confirm("Are you sure you want to delete this chat?")) {
      fetch(`/chats/${chatId}`, {
        method: 'DELETE'
      })
      .then(res => res.json())
      .then(data => {
        alert(data.message);
        // Optionally refresh or redirect
        location.reload();
      })
      .catch(err => console.error(err));
    } else {
      alert("Deletion cancelled.");
    }
  }
</script>

    
</body>
</html>